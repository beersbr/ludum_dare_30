<!doctype html>
<html>
<head>
	<title>Editor</title>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/editor.css">
</head>
<body>

	<div class="content" >
		<ul id="tiles">
		</ul>
	</div>

	<div class="content">
		<table id="editor-table">
			<tr class='row' id='row-1'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-2'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-3'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-4'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-5'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-6'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-7'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-8'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-9'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-10'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-11'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
			<tr class='row' id='row-12'>
				<td class="col-1"></td>
				<td class="col-2"></td>
				<td class="col-3"></td>
				<td class="col-4"></td>
				<td class="col-5"></td>
				<td class="col-6"></td>
				<td class="col-7"></td>
				<td class="col-8"></td>
				<td class="col-9"></td>
				<td class="col-10"></td>
				<td class="col-11"></td>
				<td class="col-12"></td>
				<td class="col-13"></td>
				<td class="col-14"></td>
				<td class="col-15"></td>
				<td class="col-16"></td>
				<td class="col-17"></td>
				<td class="col-18"></td>
			</tr>
		</table>
	</div>

	<button id="save">Save</button>
	<textarea id="output"></textarea>

</body>
<script type="text/javascript">

function desc(name, image){
	var t = "<dl class='item' id='"+name+"'><dt>"+name+"</dt><dd>"+image[0].outerHTML+"</dd></dl>";

	return t;
}

function setup(){
	var selected_key = Object.keys(images)[0];

	$("dl").on("click", function(){
		selected_key = $(this).find("dt").html();
	})

	$("td").on("click", function(){
		$(this).html(images[selected_key].outerHTML);
	});

	$("#save").on("click", function(){
		var map = [];

		$.each($('.row'), function(i, item){
			var r = [];
			$(item).find("img").each(function(i, e){
				r.push($(e).data("name"));
			});
			map.push(r);
		});

		$("#output").html(JSON.stringify(map));
	});
}

$(document).ready(function(){

	images = {};

	$.ajax({url: "json/tiles.json"}).success(function(e){
		console.log(e);

		var len = Object.keys(e).length;
		var loaded = 0;

		for(var k in e){
			images[k] = new Image;
			images[k].src = e[k];
			images[k].onload = (function(evt){
				$(images[this]).attr("data-name", this);
				$("#tiles").append($(desc(this, $(images[this]) ) ));
				loaded += 1;
				if(loaded == len)
					setup();
			}).bind(k)
		}
	});



});

</script>
</html>